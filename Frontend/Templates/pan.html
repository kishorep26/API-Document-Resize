<!DOCTYPE html>
<html>

<head>
    <title>Upload PAN card</title>
    <link rel="stylesheet" href="/static/css/aadhar.css">
</head>

<body>
    <center>
        <h1>UPLOAD PAN CARD IMAGE</h1>
    </center>

    <div class="cont">
        <img src="/static/images/1.png" width="400" height="200">
    </div>

    <div class="center">
        <!-- Image Upload Section -->
        <div class="image-upload-wrap">
            <input id="fileInput" name="file" class="file-upload-input" type="file" onchange="readURL(this);"
                accept="image/*" />
            <div class="drag-text">
                <h3>Drag and drop Image or click to select Image</h3>
            </div>
        </div>

        <div class="file-upload-content">
            <img class="file-upload-image" src="#" alt="your image" />
            <div class="image-title-wrap">
                <button type="button" onclick="removeUpload()" class="remove-image">
                    Remove <span class="image-title">Uploaded PAN Card Image</span>
                </button>
            </div>
        </div>

        <!-- Verification Options -->
        <h3>VERIFICATION OPTIONS:</h3>
        <button onclick="verifyPAN()" class="file-upload-btn">Verify PAN Card</button>
        <br><br>

        <!-- Resize Section -->
        <h3>RESIZE YOUR IMAGE HERE:</h3>
        <label>Select a choice</label>
        <select id="resizeType">
            <option value="MAR">Maintain Aspect Ratio</option>
            <option value="Hard">Hard Resizing</option>
        </select>
        <center>
            <h4>Width</h4><input type="number" id="width" placeholder="Enter width"> px
            <h4>Height</h4><input type="number" id="height" placeholder="Enter height"> px
            <br><br>
            <button onclick="resizePAN()" class="file-upload-btn">Resize Image</button>
        </center>

        <!-- OR Number Entry -->
        <div class="file-upload">
            <h2>OR ENTER PAN CARD NUMBER</h2>
            <input type="text" id="panNumber" placeholder="ABCDE1234F" style="text-transform: uppercase;">
            <br><br>
            <button onclick="verifyPANNumber()" class="file-upload-btn">Verify Number</button>
        </div>

        <!-- Result Display -->
        <div id="result" style="margin-top: 20px; padding: 15px; display: none; border-radius: 5px;"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/static/js/aadhar.js"></script>
    <script>
        // Verify PAN from image
        function verifyPAN() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files || !fileInput.files[0]) {
                showResult('Please upload an image first!', false);
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            showResult('Verifying...', null);

            fetch('/panVerification', {
                method: 'POST',
                body: formData
            })
                .then(response => response.text())
                .then(data => {
                    try {
                        const result = eval('(' + data + ')');
                        if (result.valid) {
                            showResult(`✓ Valid PAN Card! Number: ${result.number}`, true);
                        } else {
                            showResult('✗ Invalid PAN Card or could not extract number', false);
                        }
                    } catch (e) {
                        showResult('Error processing response', false);
                    }
                })
                .catch(error => {
                    showResult('Error: ' + error.message, false);
                });
        }

        // Verify PAN number
        function verifyPANNumber() {
            const number = document.getElementById('panNumber').value.toUpperCase();
            if (!number) {
                showResult('Please enter a PAN number!', false);
                return;
            }

            const formData = new FormData();
            formData.append('number', number);

            showResult('Verifying...', null);

            fetch('/panVerification', {
                method: 'POST',
                body: formData
            })
                .then(response => response.text())
                .then(data => {
                    try {
                        const result = eval('(' + data + ')');
                        if (result.valid) {
                            showResult(`✓ Valid PAN Number! ${result.number}`, true);
                        } else {
                            showResult('✗ Invalid PAN Number format', false);
                        }
                    } catch (e) {
                        showResult('Error processing response', false);
                    }
                })
                .catch(error => {
                    showResult('Error: ' + error.message, false);
                });
        }

        // Resize PAN
        function resizePAN() {
            const fileInput = document.getElementById('fileInput');
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            const resizeType = document.getElementById('resizeType').value;

            if (!fileInput.files || !fileInput.files[0]) {
                showResult('Please upload an image first!', false);
                return;
            }

            if (!width || !height) {
                showResult('Please enter both width and height!', false);
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('width', width);
            formData.append('height', height);

            const endpoint = resizeType === 'MAR' ? '/panResizeMAR' : '/panResizeHard';

            showResult('Resizing...', null);

            fetch(endpoint, {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        throw new Error('Resize failed');
                    }
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'resized_pan.jpeg';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showResult('✓ Image resized and downloaded successfully!', true);
                })
                .catch(error => {
                    showResult('Error: ' + error.message, false);
                });
        }

        // Show result message
        function showResult(message, success) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';

            if (success === true) {
                resultDiv.style.backgroundColor = '#d4edda';
                resultDiv.style.color = '#155724';
                resultDiv.style.border = '1px solid #c3e6cb';
            } else if (success === false) {
                resultDiv.style.backgroundColor = '#f8d7da';
                resultDiv.style.color = '#721c24';
                resultDiv.style.border = '1px solid #f5c6cb';
            } else {
                resultDiv.style.backgroundColor = '#d1ecf1';
                resultDiv.style.color = '#0c5460';
                resultDiv.style.border = '1px solid #bee5eb';
            }
        }
    </script>
</body>

</html>